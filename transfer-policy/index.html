<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Transfer Policy - Sui Kiosk</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../what-is-sui-kiosk.html"><strong aria-hidden="true">1.</strong> What is Sui Kiosk</a></li><li class="chapter-item expanded "><a href="../overview.html"><strong aria-hidden="true">2.</strong> Overview</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../philosophy.html"><strong aria-hidden="true">2.1.</strong> Philosophy</a></li><li class="chapter-item expanded "><a href="../guarantees.html"><strong aria-hidden="true">2.2.</strong> Guarantees</a></li><li class="chapter-item expanded "><a href="../roles/index.html"><strong aria-hidden="true">2.3.</strong> Roles</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../roles/kiosk-owner.html"><strong aria-hidden="true">2.3.1.</strong> Kiosk Owner (Seller)</a></li><li class="chapter-item expanded "><a href="../roles/creator.html"><strong aria-hidden="true">2.3.2.</strong> Creator</a></li><li class="chapter-item expanded "><a href="../roles/buyer.html"><strong aria-hidden="true">2.3.3.</strong> Buyer</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../transfer-policy/index.html" class="active"><strong aria-hidden="true">3.</strong> Transfer Policy</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../transfer-policy/rules.html"><strong aria-hidden="true">3.1.</strong> Rules</a></li><li class="chapter-item expanded "><a href="../transfer-policy/writing-rules.html"><strong aria-hidden="true">3.2.</strong> Writing Rules</a></li><li class="chapter-item expanded "><a href="../transfer-policy/multiple-transfer-policies.html"><strong aria-hidden="true">3.3.</strong> Multiple Transfer Policies</a></li></ol></li><li class="chapter-item expanded "><a href="../kiosk/index.html"><strong aria-hidden="true">4.</strong> Kiosk</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../kiosk/create.html"><strong aria-hidden="true">4.1.</strong> &quot;Open a Kiosk&quot;</a></li><li class="chapter-item expanded "><a href="../kiosk/place-and-take.html"><strong aria-hidden="true">4.2.</strong> Place and Take</a></li><li class="chapter-item expanded "><a href="../kiosk/locking.html"><strong aria-hidden="true">4.3.</strong> Locking</a></li><li class="chapter-item expanded "><a href="../kiosk/list-and-delist.html"><strong aria-hidden="true">4.4.</strong> List and Delist</a></li><li class="chapter-item expanded "><a href="../kiosk/purchase.html"><strong aria-hidden="true">4.5.</strong> Purchase</a></li><li class="chapter-item expanded "><a href="../kiosk/borrowing.html"><strong aria-hidden="true">4.6.</strong> Borrowing</a></li><li class="chapter-item expanded "><a href="../kiosk/withdrawing-profits.html"><strong aria-hidden="true">4.7.</strong> Withdrawing Profits</a></li><li class="chapter-item expanded "><a href="../kiosk/purchase-cap.html"><strong aria-hidden="true">4.8.</strong> Custom trading with PurchaseCap</a></li><li class="chapter-item expanded "><a href="../kiosk/purchase-cap-tricks.html"><strong aria-hidden="true">4.9.</strong> PurchaseCap tricks</a></li><li class="chapter-item expanded "><a href="../kiosk/extensions.html"><strong aria-hidden="true">4.10.</strong> Extensions</a></li></ol></li><li class="chapter-item expanded "><a href="../kiosk-extensions/index.html"><strong aria-hidden="true">5.</strong> Kiosk Extensions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../kiosk-extensions/simple-extensions.html"><strong aria-hidden="true">5.1.</strong> Simple Extensions</a></li><li class="chapter-item expanded "><a href="../kiosk-extensions/extensions-api/index.html"><strong aria-hidden="true">5.2.</strong> Extensions API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../kiosk-extensions/extensions-api/adding-an-extension.html"><strong aria-hidden="true">5.2.1.</strong> Adding an Extension</a></li><li class="chapter-item expanded "><a href="../kiosk-extensions/extensions-api/extension-permissions.html"><strong aria-hidden="true">5.2.2.</strong> Extension Permissions</a></li><li class="chapter-item expanded "><a href="../kiosk-extensions/extensions-api/extension-storage.html"><strong aria-hidden="true">5.2.3.</strong> Extension Storage</a></li><li class="chapter-item expanded "><a href="../kiosk-extensions/extensions-api/disabling-and-removing.html"><strong aria-hidden="true">5.2.4.</strong> Disabling and Removing</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../building-with-kiosk/index.html"><strong aria-hidden="true">6.</strong> Building with Kiosk</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../building-with-kiosk/indexing-events.html"><strong aria-hidden="true">6.1.</strong> Indexing Events</a></li><li class="chapter-item expanded "><a href="../building-with-kiosk/using-kiosk-in-a-module.html"><strong aria-hidden="true">6.2.</strong> Using Kiosk in a Module</a></li><li class="chapter-item expanded "><a href="../building-with-kiosk/custom-event-handlers-in-extensions.html"><strong aria-hidden="true">6.3.</strong> Custom Event handlers in Extensions</a></li><li class="chapter-item expanded "><a href="../building-with-kiosk/demo-applications.html"><strong aria-hidden="true">6.4.</strong> Demo Applications</a></li></ol></li><li class="chapter-item expanded "><a href="../mysten-kiosk/index.html"><strong aria-hidden="true">7.</strong> Mysten Kiosk</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../mysten-kiosk/extensions/index.html"><strong aria-hidden="true">7.1.</strong> Extensions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../mysten-kiosk/extensions/personal-kiosk.html"><strong aria-hidden="true">7.1.1.</strong> Personal Kiosk</a></li></ol></li><li class="chapter-item expanded "><a href="../mysten-kiosk/rules/index.html"><strong aria-hidden="true">7.2.</strong> Rules</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../mysten-kiosk/rules/royalty-rule.html"><strong aria-hidden="true">7.2.1.</strong> Royalty Rule</a></li><li class="chapter-item expanded "><a href="../mysten-kiosk/rules/kiosk-lock-rule.html"><strong aria-hidden="true">7.2.2.</strong> Kiosk Lock Rule</a></li><li class="chapter-item expanded "><a href="../mysten-kiosk/rules/personal-kiosk.html"><strong aria-hidden="true">7.2.3.</strong> Personal Kiosk Rule</a></li><li class="chapter-item expanded "><a href="../mysten-kiosk/rules/witness-rule.html"><strong aria-hidden="true">7.2.4.</strong> Witness Rule</a></li><li class="chapter-item expanded "><a href="../mysten-kiosk/rules/floor-price-rule.html"><strong aria-hidden="true">7.2.5.</strong> Floor Price Rule</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../appendix/index.html"><strong aria-hidden="true">8.</strong> Appendix</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../appendix/glossary.html"><strong aria-hidden="true">8.1.</strong> A - Glossary</a></li><li class="chapter-item expanded "><a href="../appendix/asset-states-in-kiosk.html"><strong aria-hidden="true">8.2.</strong> B - Asset States in Kiosk</a></li><li class="chapter-item expanded "><a href="../appendix/extension-states.html"><strong aria-hidden="true">8.3.</strong> C - Extension States</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Sui Kiosk</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#transfer-policy" id="transfer-policy">Transfer Policy</a></h1>
<p>To understand the Kiosk we first need to go through the Transfer Policy.
<code>transfer_policy</code> is a library located in the Sui Framework; it allows creating
a non-discardable message - called <code>TransferRequest</code> - and the destination for
this message - <code>TransferPolicy</code>.</p>
<h2><a class="header" href="#introduction" id="introduction">Introduction</a></h2>
<p>Imagine a tax system implementation: multiple merchants process payments and
buyers need to pay &quot;<a href="https://en.wikipedia.org/wiki/Value-added_tax">VAT</a>&quot;. The
tax is calculated based on the price of the purchased item, and different
categories of items have different tax rates.</p>
<blockquote>
<p>In most of the countries, the VAT is first collected by the merchant. The
merchant must keep track of the tax paid for each item and pay the collected
taxes to the tax authority in the end of the period.</p>
</blockquote>
<p>To create a system like this without extra overhead on the merchants' side (the
buyer pays the tax directly) we could issue a &quot;receipt&quot; for each purchase which
would contain the information about the item type and the price paid. The buyer
would then need to pay the VAT directly to the tax authority based on the
receipt.</p>
<p>Move language has a primitive which allows creating a non-discardable message
called &quot;<a href="https://examples.sui.io/patterns/hot-potato.html">Hot Potato</a>&quot;. Once
created, the Hot Potato can only be consumed by a specific module (or object),
and if it is not consumed, the transaction will fail.</p>
<p>Applied to this scenario, the &quot;receipt&quot; would be a Hot Potato, forcing the buyer
to do something with it - pay the tax - before the transaction can be finalized.</p>
<h2><a class="header" href="#transfer-request" id="transfer-request">Transfer Request</a></h2>
<p>The <code>TransferRequest</code> struct and the matching <code>TransferPolicy</code> object address
this problem. If a merchant creates a <code>TransferRequest</code> upon each purchase, and
the <code>TransferPolicy</code> is configured to enforce the tax policy, the buyer will not
be able to finalize the purchase the item until the tax is paid.</p>
<p>This is a strong guarantee, because the <code>TransferRequest</code> is a non-discardable
struct - &quot;Hot Potato&quot; - and unless it finds &quot;its home&quot;, the transaction won't
succeed. The <code>TransferPolicy</code> is the &quot;home&quot; for the <code>TransferRequest</code> and it
can be configured by the authority to require certain conditions to be met for
the <code>TransferRequest</code> to be accepted.</p>
<p>Because the system is designed for commerce, the <code>TransferRequest</code> has the most
commonly used fields, all of which are set at creation and can't be changed,
such as:</p>
<ul>
<li><code>paid</code> (the amount of SUI paid for the item)</li>
<li><code>item</code> (the ID of the item being transferred)</li>
<li><code>from</code> (the ID of the source the item is being sold from)</li>
</ul>
<p>Additionally, thanks to the Move's type system, the <code>TransferRequest</code> is issued
per <em>type</em>. This means that the <code>TransferRequest</code> for a &quot;Phone&quot; is different
from the <code>TransferRequest</code> for a &quot;Car&quot;. This allows to enforce different rules
for different types of items.</p>
<h2><a class="header" href="#example-merchant" id="example-merchant">Example: Merchant</a></h2>
<p>A module implementing the merchant logic for the &quot;Phone&quot; type could look like
this:</p>
<pre><code class="language-Move">/// An example of a module on Sui which sells &quot;Phones&quot;.
module commerce::merchant {
    use sui::transfer_policy::{Self, TransferRequest};
    use tax::vat::VAT;

    /// A single &quot;Phone&quot; - a Sui Object.
    struct Phone has key, store { /* ... */ }

    /// A price of a single &quot;Phone&quot;.
    const PHONE_PRICE: u64 = 10_000_000_000;

    /// Some merchant ID (usually represented by a Sui Object)
    const MERCHANT_ID: address = 0xBEEF;

    /// The merchant is selling phones, the buyer only pays to the merchant the
    /// price of the phone, and the tax is paid separately and directly to the
    /// tax authority. `VAT` type is imported and can only be resolved by the
    /// authority defining this type.
    public fun buy_phone(/* pass a coin */): (Phone, TransferRequest&lt;VAT&gt;) {

        let phone = Phone { /* ... */ };

        // Generate new `TransferRequest` for the `VAT` type, specify the ID
        // of the `Phone` object, the price of the `Phone` and the ID of the
        // merchant.
        let request = transfer_policy::new_request&lt;VAT&gt;(
            object::id(&amp;phone),
            PHONE_PRICE,
            object::id_from_address(MERCHANT_ID),
        );

        (phone, request)
    }
}
</code></pre>
<h2><a class="header" href="#transfer-policy-1" id="transfer-policy-1">Transfer Policy</a></h2>
<p>A <code>TransferRequest</code> can only be matched in a <code>TransferPolicy</code> object. The match
happens based on the type of the <code>TransferRequest</code> and the <code>TransferPolicy</code>. If
the <code>TransferRequest</code> is for the &quot;Phone&quot; type, it can only be matched by the
<code>TransferPolicy</code> for the &quot;Phone&quot; type.</p>
<blockquote>
<p>In the example above the <code>TransferRequest</code> is for the &quot;VAT&quot; type, so it can
only be matched by the <code>TransferPolicy</code> for the &quot;VAT&quot; type.</p>
</blockquote>
<p><code>TransferPolicy&lt;T&gt;</code> is a Sui Object which can be created for any type by the
<a href="https://examples.sui.io/basics/publisher.html">Publisher</a> of this type.</p>
<pre><code class="language-Move">/// An example of a TransferPolicy setup. Better be done via PTBs and not as a
/// published module. The code below is for illustration purposes only.
module tax::vat {
    use sui::tx_context::{sender, TxContext};
    use sui::transfer_policy::{Self, TransferPolicy};

    /// The authority defines the `VAT` type. It is never initialized and only
    /// used to create and resolve `TransferRequest`s.
    struct VAT has drop {}

    /// The publisher creates and shares a `TransferPolicy` for the `VAT` type.
    public fun create_policy(pub: &amp;Publisher, ctx: &amp;mut TxContext) {
        let (policy, policy_cap) = transfer_policy::new_policy&lt;VAT&gt;(pub, ctx);

        sui::transfer::public_share_object(policy);
        sui::transfer::public_transfer(policy_cap, sender(ctx));
    }

    /// Can be called directly in the `TransferPolicy` module; does not need a
    /// custom implementation. This code is for illustration purposes only.
    public fun confirm_request(
        policy: &amp;TransferPolicy&lt;VAT&gt;, request: TransferRequest&lt;VAT&gt;
    ) {
        transfer_policy::confirm_request&lt;VAT&gt;(policy, request);
    }

    /// Using the OTW (VAT), create the Publisher object and transfer it to the
    /// transaction sender.
    fun init(otw: VAT, ctx: &amp;mut TxContext) {
        sui::package::claim_and_keep(otw, ctx);
    }
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../roles/buyer.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../transfer-policy/rules.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../roles/buyer.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../transfer-policy/rules.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
